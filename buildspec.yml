version: 0.2

phases:
  install:
    commands:
      - apt-get update
      - apt install jq
  pre_build:
    commands:
      - echo Logging in to Amazon ECR...
      - $(aws ecr get-login-password --region us-west-2 | docker login -u AWS -p eyJwYXlsb2FkIjoiejQ0SWF5Qk5uTXhwWUhXNVpyY1FneExYQ3JvRDZVTkVVU1VHRWVDOEYrbnlPNVk3cHd1N2dEQ3M5cHBZbXE1UWswa3pXWHRnTnd4NXRVcXVYNTRtS09qMW9iK09VdGQyRHh3cTVCaS80bXdOVzhhUGt1VlBFQkJVUlJkOEFzUFVFbTNxSUlmeUxWditqMHhvZXZUQVVEcmlTVVRidEE5MkdRSlBQS1hoZlgyUDQ5VUd2WjRLcWFYa1czTk5nN0tJTzZjeVNObE8wbCtyOXJMTURIUmJidkRXSko1WVBhRFo2d25BZ2FTREczNS9VRTcvSkUvUGJDMU9qNmI4Mko4Rk1INHhoWE16RWNEWWZPSzVKUlZzYVp5Y1lhV0p3RDVDaENuL0RFWHFQVkU2TlhCYmdnSjVCSTk0YlE0U3BVd0JUT0hCUW1vekhqbGt2VzZsRENOTENiU1o4WG1mMm1UejJ4d0FqaXY4NmsrYUF3cDhIa3YvakdHeEw3alRETWZ0MWgyVDRBRkZwZkpKME43cWhRTkpOdHpCRDd3NWZTM09WdTlYRlNtVGVCN3A4VDA2S1EvNlovd29QV0hDSjlmQS9wOGxkOVBKcWlSUXk4ZFQydEVwbzhhcHkrTGRaL3ZFY0pjREVvZVRneVZuTDBLQlhKYS9vczhRMUNxZkloZmFGSVhYV3dzZlk0bmUyaTlkcVE3WE0vWlM5c0dQVEs3N0pOK3o4SnhTSm8yamRMMmluVUxHU0dhd04yQXE3am9COFArZUUvMzJOeXUybnM4KytDMTdmTXlVY1BRRkdBWkNiUXd3eG1XOE9EOE1Gc3p2bnZlbllBYzFQVm1INlMyNjlEZmd5aUVHdlFOaWt0MTZsQWVRbjhBWkZIT2RGVThVaGk0SEQyYmgzakg3WEVqVEdWQlA4V00weWtoSkdLcENyN0xuR3ZwZzJoVXorSTRySXkvV3FJUDVYNFV0dFROZUUrMFNxL0dSdkd5eGlSanUyUHZVT3hkeEpIc2hqRzgzRUNEcTRZYUliUVFyRzI3c1RQNTRFOTZPMmdwc0p1cFV1Q204SDZ5cU55ZGQ1WlMrYnlZeTlsSTdRSTBxRjVzN2Z6SGtYSEs1T2R1enBhU3FRSXk4V0l1Ri9iajJnK0VpeGk1bEVYZ0xvMWxWT1l2Z0VmV3RjeDVLV1Y3VGttdXNqeHZFSUw5ejk2dUZUMUVuMzBmdXJGbUx3eHRaNVY4MlhTbkc1S3BtNlU4MHAxMGdYVFVkY25mdzBnMm0vM0x3UWZ4SzRGNGplclc1UTV4bXJuMDdFSUdjclRyeHl2OGRMaWpPUVduTzV4ejJNSWhIK1ByS3B2SXlEc21JM05jWFVwWm14T2dLTndMZU9EUTViZz09IiwiZGF0YWtleSI6IkFRRUJBSGh3bTBZYUlTSmVSdEptNW4xRzZ1cWVla1h1b1hYUGU1VUZjZTlScTgvMTR3QUFBSDR3ZkFZSktvWklodmNOQVFjR29HOHdiUUlCQURCb0Jna3Foa2lHOXcwQkJ3RXdIZ1lKWUlaSUFXVURCQUV1TUJFRURDMzFaN1FUVSs5ek4yTkJVd0lCRUlBN2ZENjZNRFpGOXhwTFRoLzJhY3RVaC9JT0M3UVdyWDgxWU5KS1p6dk5BN1NJZXVoQ0g0UEJqa1JpTDBETXorUjNvRWFrM3ZMT1N5OEVaazQ9IiwidmVyc2lvbiI6IjIiLCJ0eXBlIjoiREFUQV9LRVkiLCJleHBpcmF0aW9uIjoxNjQyODk4NTY3fQ== https://720995573294.dkr.ecr.us-east-1.amazonaws.com)
      - IMAGE_TAG=$(echo $CODEBUILD_RESOLVED_SOURCE_VERSION | cut -c 1-7)
  build:
    commands:
      - echo Build started on `date`
      - echo Building the Docker image...
      - docker build -t docker-nginx-flask:latest .
      - docker tag docker-nginx-flask:latest 720995573294.dkr.ecr.us-east-1.amazonaws.com/docker-nginx-flask:latest
